---
title: "final_181"
output: html_document
date: "2024-10-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r}

# read in CSV as data frame
crime_data <- read.csv("/Users/sarahmirza/Documents/GitHub/LA-Crime-Data/Crime_Data_from_2020_to_Present.csv")

```


```{r}
# preview the crime data frame 
head(crime_data)
```

Plotting library

```{r}
library(ggplot2)
```


```{r}
#hist(crime_data$TIME.OCC)


#hist(crime_data$Crm.Cd)

# data frame containing the frequency of each crime committed per area
crime_by_region <- data.frame(xtabs(~AREA.NAME+Crm.Cd, crime_data)) 

head(crime_by_region) # preview data frame


```

In California, **violent felonies** are specifically enumerated in **Penal Code Section 667.5(c)**. These offenses are considered particularly severe and carry enhanced sentencing provisions. The list includes:

- **Murder or voluntary manslaughter** (Penal Code §187, §192)
- **Mayhem** (Penal Code §203)
- **Rape** as defined in specific subdivisions of Sections 261 and 262
- **Sodomy** as defined in subdivisions of Section 286
- **Oral copulation** as defined in subdivisions of Section 287
- **Lewd acts on a child under 14 years** (Penal Code §288)
- **Any felony punishable by death or life imprisonment**
- **Any felony** where the defendant inflicts great bodily injury on someone other than an accomplice
- **Robbery** (Penal Code §211)
- **Arson** in violation of subdivisions (a) or (b) of Section 451
- **Sexual penetration** as defined in subdivisions of Section 289
- **Attempted murder** (Penal Code §664/187)
- **Kidnapping** (Penal Code §207)
- **Assault with intent to commit a specified felony** (Penal Code §220)
- **Continuous sexual abuse of a child** (Penal Code §288.5)
- **Carjacking** (Penal Code §215)
- **Rape, spousal rape, or sexual penetration in concert** (Penal Code §264.1)
- **Extortion** as defined in Section 518, constituting a felony violation of Section 186.22
- **Threats to victims or witnesses** as defined in Section 136.1, constituting a felony violation of Section 186.22
- **First-degree burglary** where another person, other than an accomplice, was present during the commission
- **Any violation of Section 12022.53** (pertaining to firearm enhancements)
- **Violations related to weapons of mass destruction** as specified in subdivisions (b) or (c) of Section 11418

For a comprehensive list and detailed definitions, refer to the California Legislative Information website.  


Classify categories of non-violent crime and analyze their geographic distribution to identify regions in Los Angeles with the highest rates of these crimes.


```{r}
violent_crime_codes <- c(110,113,121,122,815,820,821,210,220,230,231,235,236,250,251,761,926,435,436,437,622,623,624,625,626,627,647,763,928,930) # violent crime codes in a list
```

```{r}
# if the main crime code matches a value in the violent crimes list, add it to violent crimes data frame
violent_crimes <- crime_data[crime_data$Crm.Cd %in% violent_crime_codes,]
head(violent_crimes) 

# if the main crime code does not match a value in the violent crimes list, add it to nonviolent crimes data frame
non_violent_crimes <- crime_data[!crime_data$Crm.Cd %in% violent_crime_codes,]
head(non_violent_crimes)
```

```{r}
# pie chart to show violent crime distribution in LA
violent_crimes_table <- table(violent_crimes$AREA.NAME)  # add all the area names from the violent crimes data frame

violent_crimes_sorted <- sort(violent_crimes_table,decreasing=TRUE) # sort table by most crimes first

#View(violent_crimes_top10)

# display pie chart based on data
violent_pie <- pie(violent_crimes_sorted,
    main = "Crimes by Area",
    col = rainbow(length(violent_crimes_sorted)),
    labels = names(violent_crimes_sorted))

#head(violent_crimes_sorted)
```
```{r}
# pie chart of non violent crimes
nonviolent_crimes_table <- table(non_violent_crimes$AREA.NAME) # add all area names from nonviolent crime data frame

nonviolent_crimes_sorted <- sort(nonviolent_crimes_table,decreasing=TRUE) # sort in decrementing order

# create pie chart based on nonviolent crimes
nonviolent_pie <- pie(nonviolent_crimes_sorted,
    main = "Crimes by Area",
    col = rainbow(length(nonviolent_crimes_sorted)),
    labels = names(nonviolent_crimes_sorted))

#nonviolent_crimes_sorted
```

```{r}
library(dplyr) # for filtering

# count the number of times each area occurs in the violent crime data frame
violent_by_area <- violent_crimes %>% 
  count(AREA.NAME) %>%                     
  arrange(desc(n))  # sort by most crime  

#violent_by_area

# count the number of times each area occurs in the nonviolent crime data frame
nonviolent_by_area <- non_violent_crimes %>%
  count(AREA.NAME) %>%
  arrange(desc(n)) # sort by highest crime rate

#nonviolent_by_area

# add new column to classify crime type for merging
violent_by_area$Type <- "Violent Crime"
nonviolent_by_area$Type <- "Nonviolent Crime"

# assign column names
colnames(violent_by_area) <- c("Area","Crimes","Type")
colnames(nonviolent_by_area) <- c("Area","Crimes","Type")

# negate all the nonviolent crime totals for flipped graph
nonviolent_by_area$Crimes <- -nonviolent_by_area$Crimes

# combine data frames
crimes_by_area <- rbind(violent_by_area,nonviolent_by_area)

#head(crimes_by_area)

#sort by the order they appear in their data frames (sorted by decreasing frequency)
crimes_by_area$Area <- factor(crimes_by_area$Area, levels = unique(crimes_by_area$Area))

head(crimes_by_area)
```

```{r}
# crime frequency plot 
crime_freq_plot <- ggplot(crimes_by_area, aes(x = Area, y = Crimes, fill = Type)) +
  geom_bar(stat = "identity",width=0.5) + # bar chart
  coord_flip() + # flip x and y axis 
  labs(title = "Crime Frequency by Area",
       x = "Area in Los Angeles",
       y = "Frequency") +
  theme_minimal() +
  scale_y_continuous(labels = abs) +
  scale_fill_manual(values = c("Violent Crime" = "firebrick", "Nonviolent Crime" = "purple4"))
crime_freq_plot
ggsave("CrimeFrequency.png",plot=crime_freq_plot) # save plot

```



